worker_processes  1;

events {
    # Maximum number of simultaneous connections per worker
    worker_connections  1024;
}

http {
    include       mime.types;
    # Default MIME type if unknown
    default_type  application/octet-stream;
    
    # Access and error log locations
    access_log  logs/access.log;
    error_log   logs/error.log warn;

    # Enable efficient file transfers
    sendfile on;

    # Keep idle connections alive (in seconds)
    keepalive_timeout 45;
	
    # Define an upstream (backend pool) for the Flask API
    upstream flask_api {
        server 127.0.0.1:5000;
    }

    server {
        # Listen on port 80 (HTTP)
        listen 80;
        # Domain name for this server (localhost for development)
        server_name localhost;
	
        # Path to React build folder (static frontend)
        root place_holder;
        # Default file to serve if none is specified
        index index.html;

        # React frontend routes
        location / {
            # Try to serve a file directly, otherwise fallback to index.html
            try_files $uri /index.html;
        }

        # Flask backend API
        location /api/ {
            # Forward API calls to the Flask upstream
            proxy_pass http://flask_api;

            # Preserve client request details
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
